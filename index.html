<!DOCTYPE html>
<html lang="en">
<head>
<base href="/myapp/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Al Aqsa Girls Hifz Madrasa Agreement Form</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
  @page { size: A4; margin: 0; }

  body {
    font-family: "Arial", sans-serif;
    margin: 0;
    padding: 0;
    background: #fff;
    color: #000;
  }

  #formContainer {
    width: 210mm;
    min-height: 297mm;
    box-sizing: border-box;
    border: 1px solid #000;
    padding: 10mm;
    overflow: hidden;
    margin: 0 auto; /* centered */
  }

  h1, h2 { text-align: center; margin: 0; line-height: 1.2; }
  h2 { text-decoration: underline; margin-bottom: 4px; }
  h3 { text-align: center; margin: 0; line-height: 1.2; margin-bottom: 14px; font-weight: normal; }
  p { text-align: center; margin: 0 0 6px 0; font-size: 15px; }

  label { display: inline-block; width: 110px; font-weight: bold; }
  input, select {
    padding: 3px; margin: 2px; font-size: 12px;
    border: 1px solid #ccc; border-radius: 3px;
  }

  /* Same line for Father, Mother, Mobile */
  .parent-info label { width: auto; margin-right: 3px; }
  .parent-info input { width: 30%; margin-right: 5px; }

  table {
    width: 100%; border-collapse: collapse; margin-top: 4px;
    border: 1px solid #000; font-size: 12px;
  }

  th, td {
    border: 1px solid #000; padding: 3px; text-align: center;
  }
  th { background-color: #f1f1f1; }

  .section { margin-bottom: 6px;width: 100%;font-size: 12px; margin-top: 6px}
  .signatures {
    display: flex; justify-content: space-between;
    margin-top: 50px;
  }

  .sign-box {
    text-align: center; width: 23%;
    border-top: 1px solid #000; padding-top: 4px; font-size: 12px;
  }

  .terms {
    font-size: 14px;
    margin-top: 10px;
    border: 1px solid #000;
    padding: 6px;
    line-height: 1.4;
  }

  #downloadBtn {
    margin-top: 10px;
    background: #007bff;
    color: #fff;
    padding: 6px 12px;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    font-size: 10px;
  }

  footer { text-align: center; margin-top: 8px; font-size: 20px; }

  /* Mobile 
  @media screen and (max-width: 768px) {
    #formContainer { width: 100%; min-height: auto; border: none; padding: 10px; }
    label { display: inline-block; margin-top: 4px; }
    input, select { width: 30%; margin-right: 3px; font-size: 10px; }
    table { font-size: 9px; overflow-x: auto; display: block; }
    th, td { padding: 3px; }
    .signatures { flex-direction: column; align-items: center; }
    .sign-box { width: 80%; margin-top: 12px; }
    #downloadBtn { width: 100%; }
  }*/
</style>
</head>

<body>

<div id="formContainer">

<h1>Visionary Trust</h1>
<p>Bashundhara, Ashulia, Savar, Dhaka-1343</p>
<h3>Brunch Name : Al Aqsa Girls Hifz Madrasa</h3>
<h2>AGREEMENT FORM</h2>

<div class="section parent-info">
  <label>Code No:</label><input type="text" id="code">
  <label>Student Name:</label><input type="text" id="name"><br>

  <label>Class:</label>
  <select id="class" onchange="updateTuitionFee()">
    <option value="">Select</option>
    <option>Play</option>
    <option>Nursery</option>
    <option>One</option>
    <option>Two</option>
    <option>Three</option>
    <option>Four</option>
    <option>Five</option>
    <option>Six</option>
    <option>Seven</option>
    <option>Eight</option>
    <option>Nine</option>
    <option>Ten</option>
  </select>

  <label>Admission Date:</label><input type="date" id="admissionDate"><br>

  <label>Date of Birth:</label><input type="date" id="dob">
  <label>Student Type:</label>
  <select id="studentType" onchange="filterFees()">
    <option value="">Select</option>
    <option>Residential</option>
    <option>Non-Residential</option>
    <option>Day Care</option>
    <option>Partial Residential</option>
  </select><br>
 <label>Reference:</label><input type="text" id="reference">
  <label>Session:</label><input type="text" id="session">
</div>

<!-- Parent info same line -->
<div class="section parent-info">
  <label>Father's Name:</label><input type="text" id="fatherName">
  <label>Mother's Name:</label><input type="text" id="motherName">
 
</div>

<div class="section parent-info">
   <label>Father Mobile:</label><input type="text" id="fatherMobile">
  <label>Mother Mobile:</label><input type="text" id="motherMobile">
</div>

<table id="feeTable">
  <thead>
    <tr>
      <th>SL</th>
      <th>Fee Type</th>
      <th>Frequency</th>
      <th>Fixed (৳)</th>
      <th>Discount (৳)</th>
      <th>Payable (৳)</th>
    </tr>
  </thead>
  <tbody id="feeBody"></tbody>
  <tfoot>
    <tr>
      <th colspan="3">Total</th>
      <th id="totalFixed">0</th>
      <th id="totalDiscount">0</th>
      <th id="totalPayable">0</th>
    </tr>
  </tfoot>
</table>

<div class="section">
  <label>Agreement Period:</label>
  <select id="period">
    <option>3 Months</option>
    <option>6 Months</option>
    <option>1 Year</option>
  </select>
  <label>From:</label><input type="month" id="fromDate">
  <label>To:</label><input type="month" id="toDate" readonly>
</div>

<div class="terms">
  <strong>Note:</strong><br>
  1️⃣ Monthly fees must be paid within the 10th of each month, otherwise a fine of 500 Taka will be applicable.<br>
  2️⃣ The admission or agreement may be cancelled by the authority at any time.
</div>

<div class="signatures">
  <div class="sign-box">Recommended By</div>
  <div class="sign-box">Guardian</div>
  <div class="sign-box">Vice Principal</div>
  <div class="sign-box">Principal</div>
</div>

</div> <!-- formContainer end -->

<footer>
  <button id="downloadBtn" onclick="downloadPDF()">Download PDF</button>
  <button onclick="window.print()">Print</button>

</footer>

<script>
const fees = [
  {type:"Admission Form Fee", freq:"One Time", amount:500},
  {type:"Admission Fee", freq:"One Time", amount:8000},
  {type:"Session Fee", freq:"Yearly", amount:4000},
  {type:"Accommodation Fee", freq:"One Time", amount:5000},
  {type:"Monthly Hostel Fee", freq:"Monthly", amount:7000},
  {type:"Monthly Day Care Fee", freq:"Monthly", amount:6000},
  {type:"Hostel Fee Without Food", freq:"Monthly", amount:4000},
  {type:"Monthly Tuition Fee", freq:"Monthly", amount:0},
  {type:"Examination Fee", freq:"Yearly", amount:2000},
  {type:"Annual Sports Fee", freq:"Yearly", amount:1000},
  {type:"ID Card Fee", freq:"Yearly", amount:200},
  {type:"Generator & ICT Fee", freq:"Monthly", amount:200},
  {type:"Previous Year Due", freq:"One Time", amount:0}
];

window.onload = () => {
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("admissionDate").value = today;
  renderTable();
};

function renderTable() {
  const tbody = document.getElementById('feeBody');
  tbody.innerHTML = "";
  fees.forEach((fee, i) => {
    const row = document.createElement('tr');
    row.dataset.type = fee.type;
    row.innerHTML = `
      <td>${i+1}</td>
      <td>${fee.type}</td>
      <td>${fee.freq}</td>
      <td><input type="number" value="${fee.amount}" oninput="calcTotal()"></td>
      <td><input type="number" value="0" oninput="calcTotal()"></td>
      <td class="payable">0</td>
    `;
    tbody.appendChild(row);
  });
  calcTotal();
}

function calcTotal(){
  let totalFixed=0,totalDiscount=0,totalPayable=0;
  let visibleIndex=1;
  document.querySelectorAll('#feeBody tr').forEach(row=>{
    if(row.style.display==="none") return;
    row.children[0].textContent = visibleIndex++;
    const fixed=parseFloat(row.children[3].children[0].value)||0;
    const disc=parseFloat(row.children[4].children[0].value)||0;
    const pay=Math.max(fixed-disc,0);
    row.children[5].textContent=pay;
    totalFixed+=fixed; totalDiscount+=disc; totalPayable+=pay;
  });
  document.getElementById('totalFixed').textContent=totalFixed;
  document.getElementById('totalDiscount').textContent=totalDiscount;
  document.getElementById('totalPayable').textContent=totalPayable;
}

function updateTuitionFee(){
  const cls=document.getElementById('class').value;
  const tuition=fees.find(f=>f.type==="Monthly Tuition Fee");
  if(cls==="Play") tuition.amount=2500;
  else if(cls==="Nursery") tuition.amount=3000;
  else if(["One","Two","Three"].includes(cls)) tuition.amount=3500;
  else if(["Four","Five","Six","Seven","Eight","Nine","Ten"].includes(cls)) tuition.amount=4000;
  renderTable();
}

function filterFees(){
  const type=document.getElementById('studentType').value;
  document.querySelectorAll('#feeBody tr').forEach(row=>{
    const name=row.dataset.type;
    row.style.display="";
    if(type==="Residential"){
      if(["Monthly Day Care Fee","Hostel Fee Without Food"].includes(name)) row.style.display="none";
    } else if(type==="Non-Residential"){
      if(["Accommodation Fee","Monthly Hostel Fee","Monthly Day Care Fee","Hostel Fee Without Food"].includes(name)) row.style.display="none";
    } else if(type==="Day Care"){
      if(["Monthly Hostel Fee","Hostel Fee Without Food"].includes(name)) row.style.display="none";
    } else if(type==="Partial Residential"){
      if(["Monthly Hostel Fee","Monthly Day Care Fee"].includes(name)) row.style.display="none";
    }
  });
  calcTotal();
}

document.getElementById('period').addEventListener('change', updateToDate);
document.getElementById('fromDate').addEventListener('change', updateToDate);

function updateToDate(){
  const from = document.getElementById('fromDate').value;
  const period = document.getElementById('period').value;
  if(!from) return;
  let to = new Date(from);
  if(period==="3 Months") to.setMonth(to.getMonth()+2);
  else if(period==="6 Months") to.setMonth(to.getMonth()+5);
   else if(period==="1 Year") to.setMonth(to.getMonth()+11);
  //else if(period==="1 Year") to.setFullYear(to.getFullYear()+1);
  document.getElementById('toDate').value = to.toISOString().slice(0,7);
}

function downloadPDF(){
  const btn = document.getElementById('downloadBtn');
  btn.style.display = 'none';
  const element = document.getElementById('formContainer');

  // কোড এবং নাম নিয়ে ফাইলের নাম বানানো
  let code = document.getElementById('code').value.trim();
  let name = document.getElementById('name').value.trim().replace(/\s+/g, '_');
  let filename = (code && name) ? `${code}_${name}.pdf` : 'agreement_form.pdf';

  const opt = {
    margin: 0,
    filename: filename,
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 2, scrollX: 0, scrollY: 0, backgroundColor: "#ffffff" },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(element).save().then(() => {
    btn.style.display = 'block';
  });
}
</script>

</body>
</html>


